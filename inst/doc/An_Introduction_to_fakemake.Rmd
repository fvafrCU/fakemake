---
title: "An Introduction to *fakemake*"
author: "Andreas Dominik Cullmann"
date: 2017-11-02, 12:11:26
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{An Introduction to fakemake }
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
references:
- id: powers2002
  title: Unix Power Tools
  author:
  - family: Powers
    given: Shelley
  - family: Peek
    given: Jerry
  - family: "O'Reilly"
    given: Tim
  - family: Loudikes
    given: Mike
  ISBN: 0-596-00330-7
  publisher: "O'Reilly & Associates"
  type: book
  issued:
    year: 2002
---

# Mock the Unix Make Utility
There are 
[many](https://en.wikipedia.org/wiki/List_of_build_automation_software)
[build systems](https://en.wikipedia.org/wiki/Build_automation), 
and more uses for build systems [see @powers2002, sections 11.10 and 11.11].

I have been using the 
[unix make utility](https://en.wikipedia.org/wiki/Make_(software)) when 
developing R packages since 2012. But sometimes I get caught on a machine where 
*make* is not available and where I am not entitled to install it. 
This is why I wrote *fakemake*: to build an R package conditionally on the 
modification times of (file) dependencies without having to rely on external 
software. 
If you have any proper build system at hand: stick to it, do not use *fakemake*.

# Makelists
A makelist is the *fakemake*`s representation of a Makefile. 
It's just a list of lists. Look at the 
```{r}
str(fakemake::provide_make_list("minimal"))
```

Describe names, mention phony and alias.


# A Minimal Example
Suppose we would have a minimal makelist:
```{r}
ml <- fakemake::provide_make_list("minimal")
```
Now we would use **R**`s temporary directory to build the first target in this 
makelist:

```{r}
withr::with_dir(tempdir(), print(fakemake::make(ml[[1]][["target"]], ml)))
```
We can see the files created:
```{r}
file_time <- function(files = list.files(tempdir(), full.names = TRUE)) {
    return(data.frame(path = files, modification_time = file.mtime(files)))
}
file_time(list.files(tempdir(), full.names = TRUE, pattern = "^.*\\.Rout"))
```
If we rerun the build process, we get:

```{r}
# ensure the modification time would change if the files were recreated
Sys.sleep(1)
file_time(list.files(tempdir(), full.names = TRUE, pattern = "^.*\\.Rout"))
```
Nothing changed. Good.
Now, we change one file down the build path:
```{r}
fakemake::touch(file.path(tempdir(), "b1.Rout"))
withr::with_dir(tempdir(), print(fakemake::make(ml[[1]][["target"]], ml)))
file_time(list.files(tempdir(), full.names = TRUE, pattern = "^.*\\.Rout"))
```

# References
